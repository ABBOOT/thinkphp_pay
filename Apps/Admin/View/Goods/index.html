<?php use Common\Model\StoreModel;?><div class="container-padding">  <!-- Start Row -->  <div class="row">    <!-- Start Panel -->    <div class="col-md-12">      <div class="panel panel-default">        <div class="panel-body table-responsive">            <div role="tabpanel">              <!-- Nav tabs -->              <ul class="nav nav-pills" role="tablist">                <li role="presentation" ><a href="<?php echo U('GoodsClass/index')?>" >商品类型</a></li>                <li role="presentation" class="active" ><a href="<?php echo U('Goods/index')?>">商品列表</a></li>              </ul>            </div>            <?php if($list){?>            <table class="table table-bordered display">            <?php foreach ($list as $storeId => $goodsList){?>                            <thead>                    <tr>                        <th><?php echo $goodsList[0]['store_name'];?></th>                        <th>商品类目</th>                        <th>商品名称</th>                        <th>商品价格</th>                        <th>商品排序（越大越靠前）</th>                        <th>操作</th>                    </tr>                </thead>                <tbody>                    <?php $i=1;$isAdd = false; ?>                    <?php foreach ($goodsList as $row){?>                    <?php if($row['id']){?>                    <?php $isAdd = true;?>                    <tr>                        <td ><?php echo $i++?><input type="hidden" class="edit_id" value="<?php echo $row['id']?>" /></td>                        <td  class="col-sm-3">                        <?php if(isset($classMap[$storeId])){?>                        <select class="col-sm-12 class_id" name="class_id">                        <?php foreach($classMap[$storeId] as $k=> $val){?>                            <option <?php if($val['id']==$row['class_id']){?>selected<?php }?> value="<?php echo $val['id']?>">                                <?php echo $val['class_name']?>                            </option>                        <?php }?>                        <?php }else{?>                            <a href="<?php echo U('GoodsClass/index')?>">请先添加商品类目</a>                        <?php }?>                        </select>                        </td>                        <td><input class="col-sm-12"  onblur="javascript:edit(this);" name="goods_name" type="text" value="<?php echo $row['goods_name']?>" /></td>                        <td><input class="col-sm-12"  onblur="javascript:edit(this);" name="goods_price" type="text" value="<?php echo $row['goods_price']?>" /></td>                        <td><input class="col-sm-12"  onblur="javascript:edit(this);" name="goods_sort" type="text" value="<?php echo $row['goods_sort']?>" /></td>                        <td><a class="btn btn-warning" href="javascript:;" onclick="javascript:del(<?php echo $row['id']?>);">删除</a></td>                    </tr>                    <?php }else{?>                    <tr>                        <td>+<input class="col-sm-12"  type="hidden" name="store_id" value="<?php echo $storeId?>" /></td>                        <td  class="col-sm-3">                        <?php if(isset($classMap[$storeId])){?>                        <select class="col-sm-12 class_id" name="class_id" >                        <?php foreach($classMap[$storeId] as $k=> $val){?>                            <option value="<?php echo $val['id']?>" >                                <?php echo $val['class_name']?>                            </option>                        <?php }?>                        </select>                        <?php }else{?>                            <a href="<?php echo U('GoodsClass/index')?>">请先添加商品类目</a>                        <?php }?></td>                        <td><input class="col-sm-12"  type="text" name="goods_name" /></td>                        <td><input  class="col-sm-12" type="text" name="goods_price" /></td>                        <td><input  class="col-sm-12" type="text" name="goods_sort" /></td>                        <td><button class="btn btn-success save">保存</button></td>                    </tr>                    <?php }?>                    <?php }?>                                        <?php if($isAdd){?>                    <tr>                        <td>+<input class="col-sm-12"  type="hidden" name="store_id" value="<?php echo $storeId?>" /></td>                        <td  class="col-sm-3">                        <?php if(isset($classMap[$storeId])){?>                        <select class="col-sm-12 class_id" name="class_id">                        <?php foreach($classMap[$storeId] as $k=> $val){?>                            <option value="<?php echo $val['id']?>" >                                <?php echo $val['class_name']?>                            </option>                        <?php }?>                        </select>                        <?php }else{?>                            <a href="<?php echo U('GoodsClass/index')?>">请先添加商品类目</a>                        <?php }?>                        </td>                        <td><input class="col-sm-12"  type="text" name="goods_name" /></td>                        <td><input  class="col-sm-12" type="text" name="goods_price" /></td>                        <td><input  class="col-sm-12" type="text" name="goods_sort" /></td>                        <td><button class="btn btn-success save">保存</button></td>                    </tr>                    <?php }?>                </tbody>                         <?php }?>             </table>             <?php }?>        </div>      </div>    </div>    <!-- End Panel -->  </div>  <!-- End Row --><script>function del(id){	if(confirm('确认删除'))	{		$.ajax({		    url:'<?php echo U('delHandler')?>',		    data:{id:id},		    success:function(data){		        if(ajax_check_res(data))		        {		            //		        }			}		});	}}function edit(obj){    var tr = $(obj).parents('tr');    var goods_name = tr.find("input[name='goods_name']").val();    var goods_sort = tr.find("input[name='goods_sort']").val();    var goods_price = tr.find("input[name='goods_price']").val();    var class_id = tr.find(".class_id").val();    var id = tr.find(".edit_id").val();    $.ajax({        url:'<?php echo U('editHandler');?>',        data:{goods_name:goods_name,goods_sort:goods_sort,goods_price:goods_price,class_id:class_id,id:id},        success:function(data){            if(ajax_check_res(data)){                //            }        },    });}$(function(){	$(".save").click(function(){	    var tr = $(this).parents("tr");	    var goods_name = tr.find("input[name='goods_name']").val();	    var goods_sort = tr.find("input[name='goods_sort']").val();	    var goods_price = tr.find("input[name='goods_price']").val();	    var class_id = tr.find(".class_id").val();	    var store_id = tr.find("input[name='store_id']").val();	    store_id = store_id == undefined ? tr.find("select[name='store_id']").val() : store_id;	    $.ajax({	        url:'<?php echo U('addHandler');?>',	        data:{goods_name:goods_name,goods_sort:goods_sort,goods_price:goods_price,class_id:class_id,store_id:store_id},	        success:function(data){	            if(ajax_check_res(data)){	                //	            }	        },	    });	});	//ajax_check_res();});</script>